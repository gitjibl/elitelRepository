// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/unitBezier":function(){define([],function(){var h=function(e,g,c,b){function d(d,b){var c,e,g,h;b=null==b?1E-6:b;g=d;for(e=0;8>e;e++){h=((m*g+k)*g+a)*g-d;if(Math.abs(h)<b)return g;c=(3*m*g+2*k)*g+a;if(1E-6>Math.abs(c))break;g-=h/c}c=0;e=1;g=d;if(g<c)return c;if(g>e)return e;for(;c<e;){h=((m*g+k)*g+a)*g;if(Math.abs(h-d)<b)break;d>h?c=g:e=g;g=0.5*(e-c)+c}return g}var a=3*e,k=3*(c-e)-a,m=1-a-k,h=3*g,v=3*(b-g)-h,q=1-h-v;return function(a,c){var b=d(a,c);return((q*b+v)*b+h)*
b}},g=/^cubic-bezier\((.*)\)/;h.parse=function(e){var l=h[e]||null;if(!l&&(e=g.exec(e)))e=e[1].split(",").map(function(c){return parseFloat(c.trim())}),4===e.length&&!e.some(function(c){return isNaN(c)})&&(l=h.apply(h,e));return l};h.ease=h(0.25,0.1,0.25,1);h.linear=h(0,0,1,1);h.easeIn=h["ease-in"]=h(0.42,0,1,1);h.easeOut=h["ease-out"]=h(0,0,0.58,1);h.easeInOut=h["ease-in-out"]=h(0.42,0,0.58,1);return h})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has",
"../kernel","../lang"],function(h,g,e,l,c){var b=h(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(d){if(g.isObject(d)){var a=0;this.functionName=d.rasterFunction;this.functionArguments=g.clone(d.rasterFunctionArguments||d.arguments);g.mixin(this,d);if(d=this.functionArguments)if(d.Raster=this._toRasterFunction(d.Raster),d.Raster2=this._toRasterFunction(d.Raster2),d.DEM=this._toRasterFunction(d.DEM),
d.FillRaster=this._toRasterFunction(d.FillRaster),d.Rasters&&d.Rasters.length)for(a=0;a<d.Rasters.length;a++)d.Rasters[a]=this._toRasterFunction(d.Rasters[a])}},_toRasterFunction:function(d){return d&&(d.rasterFunction||d.functionName)?new b(d):d},_rfToJson:function(d){d&&"esri.layers.RasterFunction"===d.declaredClass&&(d=d.toJson());return d},toJson:function(){var d=g.clone(this.functionArguments||this.arguments);if(d&&(d.Raster=this._rfToJson(d.Raster),d.Raster2=this._rfToJson(d.Raster2),d.DEM=
this._rfToJson(d.DEM),d.FillRaster=this._rfToJson(d.FillRaster),d.Rasters&&d.Rasters.length)){var a,b=[];for(a=0;a<d.Rasters.length;a++)b.push(this._rfToJson(d.Rasters[a]));d.Rasters=b}return c.filter({rasterFunction:this.functionName,rasterFunctionArguments:d,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});e("extend-esri")&&g.setObject("layers.RasterFunction",b,l);return b})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(h,g,e,l,c,b,d,a,k,m,t,v,q,z){h=h(q,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(a,h){h||(h={});this.urlTemplate=a;var p=new v(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new t({wkid:102100})),B=new v(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new t({wkid:102100}));this.initialExtent=h.initialExtent||p;this.fullExtent=h.fullExtent||B;this.tileInfo=h.tileInfo?h.tileInfo:new z({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,
y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,
scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,
scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new t(this.tileInfo.spatialReference.toJson());this.copyright=h.copyright||"";var q=new l(a),p=q.scheme+"://"+q.authority+"/";this.urlPath=a.substring(p.length);this.tileServers=h.tileServers||[];-1===q.authority.indexOf("{subDomain}")&&this.tileServers.push(p);if(h.subDomains&&0<h.subDomains.length&&
1<q.authority.split(".").length){this.subDomains=h.subDomains;var u;e.forEach(h.subDomains,function(a){-1<q.authority.indexOf("${subDomain}")?u=q.scheme+"://"+b.substitute(q.authority,{subDomain:a})+"/":-1<q.authority.indexOf("{subDomain}")&&(u=q.scheme+"://"+q.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(u)},this)}this.tileServers=e.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];e.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=
a.levelValue||a.level},this);var r=g.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(c("chrome")){var p=this.getTileUrl(0,0,0),B=d.defaults.io,C="with-credentials"===B.useCors?m.canUseXhr(p,!0):-1;(B=-1<C?B.corsEnabledServers[C]:null)&&B.withCredentials?k({url:p,handleAs:"arraybuffer"}).addBoth(function(a){r()}):r()}else r()},getTileUrl:function(a,d,c){a=this._levelToLevelValue[a];var k=this.tileServers[d%this.tileServers.length]+b.substitute(this.urlPath,{level:a,col:c,row:d}),k=k.replace(/\{level\}/gi,
a).replace(/\{row\}/gi,d).replace(/\{col\}/gi,c),k=this.addTimestampToURL(k);return m.addProxy(k)}});c("extend-esri")&&g.setObject("layers.WebTiledLayer",h,a);return h})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(h,g,e,l,c,b){var d=h(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,
multidimensionalDefinition:[],constructor:function(a){g.isObject(a)&&(g.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new b(a.viewpoint)),
this.multidimensionalDefinition=a.multidimensionalDefinition||[])},toJson:function(){var a=null,d=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(d)for(var a=[],b=0;b<d;b++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[b].declaredClass?this.multidimensionalDefinition[b].toJson():this.multidimensionalDefinition[b]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,
viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return c.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var b=d.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":b=d.METHOD_ATTRIBUTE;break;case "center":b=d.METHOD_CENTER;break;case "lockraster":b=d.METHOD_LOCKRASTER;break;case "nadir":b=d.METHOD_NADIR;break;case "northwest":b=d.METHOD_NORTHWEST;break;case "seamline":b=d.METHOD_SEAMLINE;
break;case "viewpoint":b=d.METHOD_VIEWPOINT}return b}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return d.OPERATION_FIRST;case "last":return d.OPERATION_LAST;case "max":return d.OPERATION_MAX;case "min":return d.OPERATION_MIN;case "blend":return d.OPERATION_BLEND;case "mean":return d.OPERATION_MEAN;case "sum":return d.OPERATION_SUM}}});g.mixin(d,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",
METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});e("extend-esri")&&g.setObject("layers.MosaicRule",d,l);return d})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),
function(h,g,e,l,c,b,d,a,k,m,t,v,q,z,n,s){var p,B,w;g=g(m,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){if(!a)throw"Image Service URL is not defined";this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(d,k,g){var h=this,m=
new l(z._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!d.imageServiceParameters)throw"Insufficient parameters to read data";var s=e.clone(d.imageServiceParameters),p=d.pixelType;c.some(this.validPixelTypes,function(f){return f===p})||(s.pixelType="F32");c.some(this.validFormats,function(f){return f.toLowerCase()===s.format.toLowerCase()})||(s.format="lerc");var v=d.decodeFunc,x;this._prepareGetImageParameters(s);m._pendingDfd=t({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",
content:e.mixin(s,{f:"image"}),load:function(f){var a=s.format.toUpperCase();"BSQ"!==a&&"BIP"!==a&&(a=h._getFormat(f));if("ERROR"===a)f=Error(String.fromCharCode.apply(null,new Uint8Array(f))),f.log=b.isDebug,h._resolve([f],null,g,m,!0);else{if(void 0===v||null===v)v=h._getFormatDecoderDfd(a);v?v(f,{width:s.width,height:s.height,planes:null,pixelType:p,noDataValue:s.noData}).then(function(f){x={pixelBlock:f,extent:s.extent};h._resolve([x,s],"onRasterReadComplete",k,m)},function(f){h._resolve([f],
null,g,m,!0)}):(f=Error("Format '"+s.format+"' is not supported."),f.log=b.isDebug,h._resolve([f],null,g,m,!0))}},error:function(f){h._resolve([f],null,g,m,!0)}});return m.promise},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new v(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new q(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==
a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var b=a.extent,c=b.spatialReference.wkid||d.toJson(b.spatialReference.toJson());delete a._ts;e.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,d){var c=a.ymax-a.ymin,k=a.xmax-a.xmin;d>=b?a.ymax=
a.ymin+k*b/d:(k=c*d/b,a.xmax=a.xmin+k);return a},_resolve:function(a,b,d,c,k){b&&this[b].apply(this,a);d&&d.apply(null,a);c&&z._resDfd(c,a,k)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip}b=e.hitch(this,b);return function(a,d){var c=new l;try{var k=b(a,d);c.resolve(k)}catch(e){c.reject(e)}return c}},_getFormat:function(a){a=
new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="JPEG":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="PNG":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="LERC":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="ERROR");return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";
},_decodeJpeg:function(a,b){if(!p)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);var d=(new p).decode(a);if(d.height!==b.height||d.width!==b.width)throw"The decoded image dimensions are incorrect.";var c=[],k,e;for(k=0;k<d.pixels.length;k++)e=d.pixels[k],c.push(this._calculateBandStatistics(e));return new n({width:d.width,height:d.height,pixels:d.pixels,pixelType:"U8",mask:d.mask,statistics:c})},_decodePng:function(a,b){if(!B)throw"The png decoder module is not loaded.";
this._validateDecodeParams(b);var d=new Uint8Array(a),c=new B(d),d=new Uint8Array(4*b.width*b.height);c.copyToImageData(d,c.decodePixels());for(var k=c=0,e,k=new Uint8Array(b.width*b.height),c=0;c<b.width*b.height;c++)k[c]=d[4*c+3];for(var h=new n({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:k,statistics:[]}),c=0;3>c;c++){e=new Uint8Array(b.width*b.height);for(k=0;k<b.width*b.height;k++)e[k]=d[4*k+c];h.addData({pixels:e,statistics:this._calculateBandStatistics(e)})}return h},_decodeBsq:function(a,
b){if(!w)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);r=b.noDataValue;b.pixelType=C(b.pixelType);var d=w.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:u,noDataValue:r}),c=[],k,e=null;for(k=0;k<d.pixels.length;k++)e=d.pixels[k],c.push(this._calculateBandStatistics(e));return new n({width:b.width,height:b.height,pixels:d.pixels,pixelType:b.pixelType,mask:d.maskData,statistics:c})},_decodeBip:function(a,b){this._validateDecodeParams(b);r=b.noDataValue;
b.pixelType=C(b.pixelType);var d=w.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:u,noDataValue:r}),c=[],k,e=null;for(k=0;k<d.pixels.length;k++)e=d.pixels[k],c.push(this._calculateBandStatistics(e));return new n({width:b.width,height:b.height,pixels:d.pixels,pixelType:b.pixelType,mask:d.maskData,statistics:c})},_decodeLerc:function(a,b){this._validateDecodeParams(b);r=b.noDataValue;b.pixelType=C(b.pixelType);for(var d=0,c,k=0,e,h=a.byteLength-10;k<h;){var g=s.decode(a,{inputOffset:k,
encodedMaskData:c,returnMask:0===d?!0:!1,returnEncodedMask:0===d?!0:!1,returnFileInfo:!0,pixelType:u,noDataValue:r}),k=g.fileInfo.eofOffset;0===d&&(c=g.encodedMaskData,e=new n({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:g.maskData,statistics:[]}));d++;if(g.height!==b.height||g.width!==b.width)throw"The decoded image dimensions are incorrect";e.addData({pixels:g.pixelData,statistics:{minValue:g.minValue,maxValue:g.maxValue,noDataValue:g.noDataValue}})}return e},_calculateBandStatistics:function(a){var b=
Infinity,d=-Infinity,c=a.length,k,e=0;for(k=0;k<c;k++)e=a[k],b=e<b?e:b,d=e>d?e:d;return{minValue:b,maxValue:d}},_loadRasterFormatModules:function(){10>a("ie")||h(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw"],function(a,b,d){p=a;B=b;w=d})}});var u=null,r=null,C=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",r=Math.pow(2,8)-1,u=Uint8Array):"U16"===a?(r=r||Math.pow(2,16)-1,u=Uint16Array):"U32"===a?(r=r||Math.pow(2,32)-1,u=Uint32Array):"S8"===a?(r=r||0-Math.pow(2,
7),u=Int8Array):"S16"===a?(r=r||0-Math.pow(2,15),u=Int16Array):"S32"===a?(r=r||0-Math.pow(2,31),u=Int32Array):u=Float32Array;return a};a("extend-esri")&&e.setObject("layers.Raster",g,k);return g})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(h,g,e,l,c,b){h=h(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=
new b(d.catalogItems));d.location&&(this.location=c.fromJson(d.location));this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.processedValues=d.processedValues;this.properties=d.properties}});e("extend-esri")&&g.setObject("tasks.ImageServiceIdentifyResult",h,l);return h})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(h,g,e,l,c,b,d,a){h=h(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(b){var c=b&&b.geometry||this.geometry;b={geometry:c,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?e.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?
e.toJson(this.renderingRule.toJson()):null};c&&(b.geometryType=a.getJsonType(c));c=this.timeExtent;b.time=c?c.toJson().join(","):null;d.isDefined(this.pixelSizeX)&&d.isDefined(this.pixelSizeY)?b.pixelSize=e.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(b.pixelSize=this.pixelSize?e.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(b.renderingRules=e.toJson(l.map(this.renderingRules,function(a){return a.toJson()})));return b}});c("extend-esri")&&g.setObject("tasks.ImageServiceIdentifyParameters",
h,b);return h})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(h,g,e,l,c){h=h(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(b){g.isObject(b)&&g.mixin(this,b)},toJson:function(){return c.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(b){return null!==
b})}});e("extend-esri")&&g.setObject("layers.DimensionalDefinition",h,l);return h})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),function(h,g,e,l,c,b,d,a,k,m,t,v,q,z,n){h=h(q,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(a){try{a=
g.mixin({bingMapsKey:null,culture:"en-US"},a||{});var b=window.location.protocol;"file:"===b&&(b="http:");this.url=b+"//dev.virtualearth.net/REST/v1";this._url=m.urlToObject(this.url);this.spatialReference=new t({wkid:102100});this.tileInfo=new v({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,
scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},
{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=
new z(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new t({wkid:102100}));g.mixin(this,a);this.hasAttributionData=this.showAttribution;this._initLayer=g.hitch(this,this._initLayer);this._errorHandler=g.hitch(this,this._errorHandler);this._getTileInfo=g.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");}catch(d){throw this.onError(d),d;}},_unsetMap:function(a,b){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var a=
this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var b=this.resourceInfo;!this.loaded&&b?this._initLayer(b):n({url:a,content:g.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(a,b){if(200!==a.statusCode){var c=Error();c.code=a.statusCode;c.message=a.statusDescription;c.details=a.errorDetails;c.authenticationResultCode=a.authenticationResultCode;
this.onError(c)}else try{this.resourceInfo=e.toJson(a);var c=a.resourceSets[0].resources[0],k=c.imageUrl.replace("{","${");this.tileServers=l.map(c.imageUrlSubdomains,function(a){var b=window.location.protocol;"file:"===b&&(b="http:");return d.substitute(k,{subdomain:a}).replace("http:",b)});this._tsLength=this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);
var g=this.loadCallback;g&&(delete this.loadCallback,g(this))}}catch(h){this.onError(h)}},getAttributionData:function(){var b=new a,d=e.fromJson(this.resourceInfo),k;this.hasAttributionData&&d&&(k=g.getObject("resourceSets.0.resources.0.imageryProviders",!1,d));k?b.callback({contributors:k}):(d=Error("Layer does not have attribution data"),d.log=c.isDebug,b.errback(d));return b},getTileUrl:function(a,b,c){return d.substitute(this.tileServers[b%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,
b,c),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(a,b,d){var c="",k,e;for(e=a;0<e;e--)a="0",k=1<<e-1,0!=(d&k)&&a++,0!=(b&k)&&(a++,a++),c+=a;return c},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},setBingMapsKey:function(a){this.bingMapsKey=a},onMapStyleChange:function(){}});g.mixin(h,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});b("extend-esri")&&g.setObject("virtualearth.VETiledLayer",
h,k);return h})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(h,g,e,l,c,b){h=h(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(b){g.mixin(this,b);this.isDataUV=b&&b.isDataUV?b.isDataUV:!1;this.computeMagnitudeAndDirection=
g.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(b,a){this.inputUnit=b;this.outputUnit=a;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=b.indexOf(this.speedUnits,this.inputUnit),a=b.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=a){var c=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=c[d]/c[a]}},computeMagnitudeAndDirection:function(b){if(!c.isDefined(b))throw"Could not compute magnitude and direction. No pixel data is available.";
var a=b.pixelBlock;if(!c.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var k=b.extent,e=(k.xmax-k.xmin)/a.width,g=(k.ymax-k.ymin)/a.height,h=k.xmin+e/2,k=k.ymax-g/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var l=180/Math.PI,z=[],n=0,s=0,p=0,B=!c.isDefined(a.mask),w,u,r,C,H,A,I,E;H=I=Infinity;A=E=-Infinity;for(n=0;n<a.height;n++)for(s=0;s<a.width;s++,p++)if(z.push([h+e*s,k-g*n]),B||a.mask[p])r=w=a.pixels[0][p]*
this.unitConversionFactor,C=u=a.pixels[1][p],this.isDataUV&&(r=Math.sqrt(w*w+u*u),C=90-l*Math.atan2(u,w),a.pixels[0][p]=r*this.unitConversionFactor,a.pixels[1][p]=C),r>A&&(A=r),r<H&&(H=r),C>E&&(E=C),C<I&&(I=C);a.statistics[0].maxValue=A;a.statistics[0].minValue=H;a.statistics[1].maxValue=E;a.statistics[1].minValue=I;b.locations=z;return b}});e("extend-esri")&&g.setObject("layers.pixelFilters.VectorFieldPixelFilter",h,l);return h})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(h,g,e,l,c,b,d,a){h=h(d,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=g.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,c,d,e,g){try{var h=new a(b);this._successHandler([h],"onComplete",d,g)}catch(l){this._errorHandler(l,e,g)}},execute:function(a,b,d,e){var h=e.assembly;a=this._encode(g.mixin({},this._url.query,{f:"json"},a.toJson(h&&h[0])));var l=this._handler,
n=this._errorHandler;return c({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,c){l(a,c,b,d,e.dfd)},error:function(a){n(a,d,e.dfd)}})},onComplete:function(){}});b._createWrappers(h);e("extend-esri")&&g.setObject("tasks.ImageServiceIdentifyTask",h,l);return h})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(h,g,e,l){h=h(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(c){c=c||{};!c.url&&
!c.type&&console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=c.url;this.type=c.type;this.isReference=!0===c.isReference?!0:!1;this.opacity=c.opacity;this.visibleLayers=c.visibleLayers;this.displayLevels=c.displayLevels;this.exclusionAreas=c.exclusionAreas;this.bandIds=c.bandIds;this.templateUrl=c.templateUrl;this.copyright=c.copyright;this.subDomains=c.subDomains;this.fullExtent=c.fullExtent;this.initialExtent=c.initialExtent;this.tileInfo=
c.tileInfo;this.tileServers=c.tileServers;this.styleUrl=c.styleUrl}});e("extend-esri")&&g.setObject("dijit.BasemapLayer",h,l);return h})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var h={defaultNoDataValue:-3.4027999387901484E38,decode:function(e,l){var c;l=l||{};var b=l.inputOffset||0,d=l.encodedMaskData||null===l.encodedMaskData,a={},k=new Uint8Array(e,b,10);a.fileIdentifierString=String.fromCharCode.apply(null,k);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+
a.fileIdentifierString;var b=b+10,m=new DataView(e,b,24);a.fileVersion=m.getInt32(0,!0);a.imageType=m.getInt32(4,!0);a.height=m.getUint32(8,!0);a.width=m.getUint32(12,!0);a.maxZError=m.getFloat64(16,!0);b+=24;if(!d)if(m=new DataView(e,b,16),a.mask={},a.mask.numBlocksY=m.getUint32(0,!0),a.mask.numBlocksX=m.getUint32(4,!0),a.mask.numBytes=m.getUint32(8,!0),a.mask.maxValue=m.getFloat32(12,!0),b+=16,0<a.mask.numBytes){var d=new Uint8Array(Math.ceil(a.width*a.height/8)),m=new DataView(e,b,a.mask.numBytes),
k=m.getInt16(0,!0),t=2,v=0;do{if(0<k)for(;k--;)d[v++]=m.getUint8(t++);else for(var q=m.getUint8(t++),k=-k;k--;)d[v++]=q;k=m.getInt16(t,!0);t+=2}while(t<a.mask.numBytes);if(-32768!==k||v<d.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=d;b+=a.mask.numBytes}else 0==(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(d=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=d);m=new DataView(e,b,16);a.pixels={};a.pixels.numBlocksY=m.getUint32(0,!0);a.pixels.numBlocksX=m.getUint32(4,
!0);a.pixels.numBytes=m.getUint32(8,!0);a.pixels.maxValue=m.getFloat32(12,!0);b+=16;d=a.pixels.numBlocksX;k=a.pixels.numBlocksY;d+=0<a.width%d?1:0;k+=0<a.height%k?1:0;a.pixels.blocks=Array(d*k);t=1E9;for(q=v=0;q<k;q++)for(var z=0;z<d;z++){var n=0,m=new DataView(e,b,Math.min(10,e.byteLength-b)),s={};a.pixels.blocks[v++]=s;var p=m.getUint8(0);n++;s.encoding=p&63;if(3<s.encoding)throw"Invalid block encoding ("+s.encoding+")";if(2===s.encoding)b++,t=Math.min(t,0);else{if(0!==p&&2!==p){p>>=6;s.offsetType=
p;if(2===p)s.offset=m.getInt8(1),n++;else if(1===p)s.offset=m.getInt16(1,!0),n+=2;else if(0===p)s.offset=m.getFloat32(1,!0),n+=4;else throw"Invalid block offset type";t=Math.min(s.offset,t);if(1===s.encoding)if(p=m.getUint8(n),n++,s.bitsPerPixel=p&63,p>>=6,s.numValidPixelsType=p,2===p)s.numValidPixels=m.getUint8(n),n++;else if(1===p)s.numValidPixels=m.getUint16(n,!0),n+=2;else if(0===p)s.numValidPixels=m.getUint32(n,!0),n+=4;else throw"Invalid valid pixel count type";}b+=n;if(3!=s.encoding)if(0===
s.encoding){m=(a.pixels.numBytes-1)/4;if(m!==Math.floor(m))throw"uncompressed block has invalid length";n=new ArrayBuffer(4*m);p=new Uint8Array(n);p.set(new Uint8Array(e,b,4*m));n=new Float32Array(n);for(p=0;p<n.length;p++)t=Math.min(t,n[p]);s.rawData=n;b+=4*m}else 1===s.encoding&&(m=Math.ceil(s.numValidPixels*s.bitsPerPixel/8),n=Math.ceil(m/4),n=new ArrayBuffer(4*n),p=new Uint8Array(n),p.set(new Uint8Array(e,b,m)),s.stuffedData=new Uint32Array(n),b+=m)}}a.pixels.minValue=t;a.eofOffset=b;var b=null!=
l.noDataValue?l.noDataValue:h.defaultNoDataValue,k=l.encodedMaskData,n=l.returnMask,t=0,v=a.pixels.numBlocksX,q=a.pixels.numBlocksY,z=Math.floor(a.width/v),s=Math.floor(a.height/q),m=2*a.maxZError,k=k||(a.mask?a.mask.bitset:null),B,d=new (l.pixelType||Float32Array)(a.width*a.height);n&&k&&(B=new Uint8Array(a.width*a.height));for(var n=new Float32Array(z*s),w,u,p=0;p<=q;p++){var r=p!==q?s:a.height%q;if(0!==r)for(var C=0;C<=v;C++){var H=C!==v?z:a.width%v;if(0!==H){var A=p*a.width*s+C*z,I=a.width-H,
E=a.pixels.blocks[t],F,G;if(2>E.encoding){if(0===E.encoding)F=E.rawData;else{F=E.stuffedData;G=E.bitsPerPixel;w=E.numValidPixels;u=E.offset;var N=m,M=n,x=a.pixels.maxValue,f=(1<<G)-1,y=0,J=void 0,K=0,D=void 0,P=void 0,U=Math.ceil((x-u)/N),J=4*F.length-Math.ceil(G*w/8);F[F.length-1]<<=8*J;for(J=0;J<w;J++)0===K&&(P=F[y++],K=32),K>=G?(D=P>>>K-G&f,K-=G):(K=G-K,D=(P&f)<<K&f,P=F[y++],K=32-K,D+=P>>>K),M[J]=D<U?u+D*N:x;F=n}G=0}else c=2===E.encoding?0:E.offset;var O;if(k)for(u=0;u<r;u++){A&7&&(O=k[A>>3],O<<=
A&7);for(w=0;w<H;w++)A&7||(O=k[A>>3]),O&128?(B&&(B[A]=1),d[A++]=2>E.encoding?F[G++]:c):(B&&(B[A]=0),d[A++]=b),O<<=1;A+=I}else if(2>E.encoding)for(u=0;u<r;u++){for(w=0;w<H;w++)d[A++]=F[G++];A+=I}else for(u=0;u<r;u++){for(w=0;w<H;w++)d[A++]=c;A+=I}if(1===E.encoding&&G!==E.numValidPixels)throw"Block and Mask do not match";t++}}}c=B;B={width:a.width,height:a.height,pixelData:d,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:b};c&&(B.maskData=c);l.returnEncodedMask&&a.mask&&(B.encodedMaskData=
a.mask.bitset?a.mask.bitset:null);if(l.returnFileInfo&&(B.fileInfo=g(a),l.computeUsedBitDepths)){c=B.fileInfo;O=a.pixels.numBlocksX*a.pixels.numBlocksY;F={};for(G=0;G<O;G++)b=a.pixels.blocks[G],0===b.encoding?F.float32=!0:1===b.encoding?F[b.bitsPerPixel]=!0:F[0]=!0;a=Object.keys(F);c.bitDepths=a}return B}},g=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?
{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:this.noDataValue}}};return h})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(h,g,e,l){h=h([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,
height:null,pixelType:null,pixels:[],statistics:[],constructor:function(c){if(c){if(!c.width||Math.floor(c.width)!==c.width)throw"PixelBlock: incorrect width";if(!c.height||Math.floor(c.height)!==c.height)throw"PixelBlock: incorrect height";if(!c.pixels||!c.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=c.width;this.height=c.height;this.pixels=c.pixels;this.pixelType=c.pixelType||null;this.statistics=c.statistics;this.mask=c.mask||null}},getPlaneCount:function(){return this.pixels.length!==
this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(c){if(!c.pixels||!c.statistics)throw"Pixel data or statistics are not present";if(c.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(c.statistics);this.pixels.push(c.pixels)},getAsRGBA:function(){var c=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(c);
break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)},getAsRGBAFloat:function(){var c=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(c);return c},clone:function(){var c=new this.constructor;c.width=this.width;c.height=this.height;c.pixelType=this.pixelType;this.mask&&(c.mask=new Uint8Array(this.mask));var b,d;if(this.pixels){c.pixels=[];d=this.pixels.length;for(b=0;b<d;b++)c.pixels[b]=new Float32Array(this.pixels[b])}if(this.statistics){c.statistics=[];d=this.statistics.length;
for(b=0;b<d;b++)c.statistics[b]=g.clone(this.statistics[b])}return c},_fillFrom8Bit:function(c){var b=this.pixels,d=this.mask;if(!c||!b||!b.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,e,g;a=e=g=b[0];3<=b.length&&(e=b[1],g=b[2]);var b=new Uint32Array(c),h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(d&&d.length===h)for(c=0;c<h;c++)d[c]&&(b[c]=-16777216|g[c]<<16|e[c]<<8|a[c]);
else for(c=0;c<h;c++)b[c]=-16777216|g[c]<<16|e[c]<<8|a[c]},_fillFromNon8Bit:function(c){var b=this.pixels,d=this.mask,a=this.statistics;if(!c||!b||!b.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var e=1,g=0;a&&0<a.length?(g=a[0].minValue,e=255/(a[0].maxValue-a[0].minValue)):(e=255,"S8"===this.pixelType?(g=-128,e=127):"U16"===this.pixelType?e=65535:"S16"===this.pixelType?(g=-32768,e=32767):"U32"===this.pixelType?e=4294967295:"S32"===this.pixelType?(g=-2147483648,
e=2147483647):"F32"===this.pixelType?(g=-3.4*1E39,e=3.4*1E39):"F64"===this.pixelType&&(g=-Number.MAX_VALUE,e=Number.MAX_VALUE),e=255/(e-g));c=new Uint32Array(c);var a=this.width*this.height,h,l,q;h=b[0];if(h.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=b.length)if(l=b[1],q=b[2],d&&d.length===a)for(b=0;b<a;b++)d[b]&&(c[b]=-16777216|(q[b]-g)*e<<16|(l[b]-g)*e<<8|(h[b]-g)*e);else for(b=0;b<a;b++)c[b]=-16777216|(q[b]-g)*e<<16|(l[b]-g)*e<<8|(h[b]-g)*e;else if(d&&
d.length===a)for(b=0;b<a;b++)l=(h[b]-g)*e,d[b]&&(c[b]=-16777216|l<<16|l<<8|l);else for(b=0;b<a;b++)l=(h[b]-g)*e,c[b]=-16777216|l<<16|l<<8|l},_fillFrom32Bit:function(c){var b=this.pixels,d=this.mask;if(!c||!b||!b.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,e,g;a=e=g=b[0];3<=b.length&&(e=b[1],g=b[2]);var h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(d&&d.length===h)for(b=
0;b<h;b++)c[l++]=a[b],c[l++]=e[b],c[l++]=g[b],c[l++]=d[b];else for(b=0;b<h;b++)c[l++]=a[b],c[l++]=e[b],c[l++]=g[b],c[l++]=255}});e("extend-esri")&&g.setObject("layers.PixelBlock",h,l);return h})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(h,g,e,l,c,b){h=h(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,
compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,toJson:function(c){var a=this.bbox||this.extent;c=(a=a&&c&&a._normalize(!0))?a.spatialReference.wkid||e.toJson(a.spatialReference.toJson()):null;var g=this.imageSpatialReference,a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:c,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:g?g.wkid||e.toJson(g.toJson()):
c,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?e.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?e.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio};c=this.timeExtent;a.time=c?c.toJson().join(","):null;return b.filter(a,
function(a){if(null!==a&&void 0!==a)return!0})}});g.mixin(h,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});l("extend-esri")&&g.setObject("layers.ImageServiceParameters",h,c);return h})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(h,g,e,l,c,b,d){h=h([b,d],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,b){this._initialize(a,b);this.useMapImage=b&&b.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=b}},exportMapImage:function(a,b){var d=c.defaults.map,d=g.mixin({size:d.width+","+d.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete d._ts;
this._exportMapImage(this._url.path+"/exportImage",d,b)}});e("extend-esri")&&g.setObject("layers.ArcGISImageServiceLayer",h,l);return h})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(h,g,e,l,c,b,d){h=h(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,b){a=a||{};!a.layers&&!a.itemId&&console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");
this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=b},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=b({url:(a||c.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:e.hitch(this,function(a,b){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),
a.addCallback(e.hitch(this,function(a,b){if(a.baseMap)return this.layers=[],g.forEach(a.baseMap.baseMapLayers,function(a){this.layers.push(new d(a))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});l("extend-esri")&&e.setObject("dijit.Basemap",h,c);return h})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require",
"dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(h,g,e,l){var c;return g(null,{constructor:function(b){this.ctx=b.ctx;this._loadRasterFormatModule()},decode:function(b,c){if(!c.width||!c.height)throw"Native decoding requires the image format, width and height";var a=new e,g,h=new Uint8Array(b),l=this._getFormat(b);if("error"===l)throw"invalid format";"jpeg"===l&&(g=this._getMask(h,c));var v="",q,z;for(q=0;q<h.length;q+=65535)z=h.subarray(q,q+65535>h.length-1?h.length-1:q+65535),v+=String.fromCharCode.apply(null,
z);var h="data:image/"+l+";base64,"+window.btoa(v),n=new Image,s;n.src=h;var p=this;n.onload=function(){p.ctx.clearRect(0,0,c.width,c.height);p.ctx.drawImage(n,0,0);var b=p.ctx.getImageData(0,0,n.width,n.height);s=b.data;if(g)for(q=0;q<g.length;q++)s[4*q+3]=g[q]?255:0;p.ctx.putImageData(b,0,0);a.resolve(null)};n.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(b){b=new Uint8Array(b,0,10);var c="error";255===b[0]&&216===b[1]?c="jpeg":137===b[0]&&(80===b[1]&&78===b[2]&&
71===b[3])&&(c="png");return c},_getMask:function(b,d){var a;try{if(!c)throw"The zlib decoder module is not loaded.";var e=0,g=0,h=Math.round(b.length/2);1===h%2&&(h+=1);for(var l=b.length-2,e=h;e<l&&!(255===b[e]&&217===b[e+1]);e++);h=e+=2;if(h<b.length-1){var q=(new c(b.subarray(h))).getBytes();a=new Uint8Array(d.width*d.height);for(e=h=0;e<q.length;e++)for(g=7;0<=g;g--)a[h++]=q[e]>>g&1}}catch(z){}return a},_loadRasterFormatModule:function(){10>l("ie")||h(["./Zlib"],function(b){c=b})}})})},"esri/layers/VectorTileLayer":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/url dojo/dom-construct dojo/dom-style dojo/has dojo/Deferred ../lang ../domUtils ../urlUtils ../kernel ../config ../request ../SpatialReference ../geometry/Extent ./layer ./TileInfo ./unitBezier".split(" "),
function(h,g,e,l,c,b,d,a,k,m,t,v,q,z,n,s,p,B,w){var u=g(p,{declaredClass:"esri.layers.VectorTileLayer",_mapsWithAttribution:["World_Basemap"],_eventMap:{"style-change":["style"]},constructor:function(a,b){this._displayLevels=b?b.displayLevels:null;this._serviceOverrides={};b&&(b.tileServers&&b.tileServers.length)&&(this._serviceOverrides.tileServers=b.tileServers.map(function(a){return D.isMapboxUrl(a)?a:t.getAbsoluteUrl(t.urlToObject(a).path)},this));if("string"===typeof a){var f=D.isMapboxUrl(a),
c=f?a:t.getAbsoluteUrl(a);if(!f&&(f=/token=([^&]+)/i.exec(c)))c=t.urlToObject(a).path,this._serviceOverrides.credential={url:c,token:f[1]};urlOrObbject=c}this.setStyle(a);this.registerConnectEvents()},setStyle:function(a){if(a)return this._loadStyle(a)},opacity:1,setOpacity:function(a){if(this.opacity!=a)this.onOpacityChange(this.opacity=a)},onOpacityChange:function(){},refresh:function(){},_loadStyle:function(b){return(new a).resolve().then(function(){var b=new a;null==d("ie")||9<d("ie")?r?r.supported()?
b.resolve():b.reject(Error("layer not supported"),!0):h(["./vector-tile"],function(a){r=a;r.supported()?b.resolve():b.reject(Error("layer not supported"),!0)}):b.reject(Error("layer not supported"),!0);return b.promise}).then(function(){r.tokenHandler?C=r.tokenHandler:(C=new P,r.tokenHandler=C);this._serviceOverrides&&this._serviceOverrides.credential&&C.addToken(this._serviceOverrides.credential);return D.loadMetadata(b,this._serviceOverrides)}.bind(this)).then(e.hitch(this,function(a){var f=a.layerDefinition;
this.serviceUrl=a.serviceUrl||null;this.styleUrl=a.styleUrl||null;f?(this.spatialReference=f.initialExtent&&f.initialExtent.spatialReference&&new n(f.initialExtent.spatialReference),this.initialExtent=f.initialExtent&&new s(f.initialExtent),this.fullExtent=f.fullExtent&&new s(f.fullExtent),this.version=f.currentVersion,this.tileInfo=new B(f.tileInfo),k.isDefined(f.minScale)&&!this._hasMin&&this.setMinScale(f.minScale),k.isDefined(f.maxScale)&&!this._hasMax&&this.setMaxScale(f.maxScale),f=null,b&&
(f=t.urlToObject(a.serviceUrl).path.toLowerCase(),f=this._getDefaultAttribution(this._getMapName(f))),f&&(this.attributionDataUrl=f,this.hasAttributionData=!0)):(this.spatialReference=F,this.initialExtent=G,this.fullExtent=N,this.tileInfo=E,this.version=null);for(var f=this.tileInfo.lods,c=this.scales=[],y=this._displayLevels,d=-Infinity,x=Infinity,e,g=0,h=f.length;g<h;g++)if(e=f[g],!y||-1!==y.indexOf(e.level))c[g]=e.scale,d=e.scale>d?e.scale:d,x=e.scale<x?e.scale:x;-Infinity!==d&&!this._hasMin&&
this.setMinScale(d);Infinity!==x&&!this._hasMax&&this.setMaxScale(x);this.style=a.style;this.gl&&(r.identityManager=v.id,this._applyGLStyle(this.style));this.onStyleChange(this.style)})).then(e.hitch(this,function(){!this.loaded&&!this.loadError&&(this.loaded=!0,this.onLoad(this))})).otherwise(e.hitch(this,function(a){this._errorHandler(a);throw a;}))},_setMap:function(a,f,y){this.inherited(arguments);this._map=a;var d=this._div=c.create("div",null,f);b.set(d,{position:"absolute",width:a.width+"px",
height:a.height+"px",overflow:"visible",opacity:this.opacity});this._onResizeHandle=a.on("resize",e.hitch(this,this._onResizeHandler));this._onOpacityHandle=this.on("opacity-change",e.hitch(this,this._opacityChangeHandler));r.identityManager=v.id;this.gl=new r.Renderer({container:d});this.gl.setSize(a.width,a.height);this._applyGLStyle(this.style);this.evaluateSuspension();if(this.suspended&&!a.loaded)var x=a.on("load",e.hitch(this,function(){x.remove();this.evaluateSuspension()}));return d},_unsetMap:function(a,
f){this.gl.remove();this.gl=null;c.destroy(this._div);this._map=this._div=null;this._onResizeHandle=this._onResizeHandle&&this._onResizeHandle.remove()&&null;this._onOpacityHandle=this._onOpacityHandle&&this._onOpacityHandle.remove()&&null;this._disableDrawConnectors();this._animation&&(this._animation.stop(),this._animation=null);this.inherited(arguments)},_applyGLStyle:function(a){var f=this.gl;f&&(a?(a.animationLoop=f.animationLoop,f.setStyle(a),a._loaded&&(Object.getOwnPropertyNames(a.sources).forEach(function(a){this.fire("source.add",
{source:this.sources[a]})},a),a.fire("load"),a.sprite.loaded()&&a.fire("change"))):f.setStyle(null))},_enableDrawConnectors:function(){var a=this._map;a&&(this._panHandle=a.on("pan",e.hitch(this,this._onPanExtentChangeHandler)),this._extentChangeHandle=a.on("extent-change",e.hitch(this,this._onPanExtentChangeHandler)),this._onScaleHandle=a.on("scale",e.hitch(this,this._onScaleHandler)))},_disableDrawConnectors:function(){this._onScaleHandle=this._onScaleHandle&&this._onScaleHandle.remove()&&null;
this._panHandle=this._panHandle&&this._panHandle.remove()&&null;this._extentChangeHandle=this._extentChangeHandle&&this._extentChangeHandle.remove()&&null},_getZoom:function(a,f){var b=this.tileInfo.lods,c=null,y=null;f=0;var d=b.length-1;for(f;f<d;f++){c=b[f];y=b[f+1];if(c.scale<=a)return f;if(y.scale===a)return f+1;if(c.scale>a&&y.scale<a){f=f+1-(a-y.scale)/(c.scale-y.scale);f=Math.ceil(f)-Math.log(Math.abs(Math.ceil(f)-f+1))/Math.LN2;if(0.995<f-Math.floor(f)||0.0050>f-Math.floor(f))f=Math.round(f);
return f}}return a>b[0].scale?b[0].level:b[b.length-1].level},_isMapAtVisibleScale:function(){var a=this.inherited(arguments);if(a){for(var f=this._map,a=this.scales,b=f.getScale(),c=!1,f=f.width>f.height?f.width:f.height,y=0,d=a.length;y<d;y++)if(Math.abs(a[y]-b)/a[y]<1/f){c=!0;break}a=c}return a},_getMapName:function(a){return(a=a.match(/^https?\:\/\/(basemaps|basemapsbeta)\.arcgis\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i))&&a[2]},_getDefaultAttribution:function(a){if(a){var f;
a=a.toLowerCase();for(var b=0,c=this._mapsWithAttribution.length;b<c;b++)if(f=this._mapsWithAttribution[b],-1<f.toLowerCase().indexOf(a))return"file:"===window.location.protocol?"http:":window.location.protocol+"//static.arcgis.com/attribution/Vector/"+f}},onStyleChange:function(a){},_opacityChangeHandler:function(a){this.gl&&(this._div.style.opacity=a.opacity)},_onResizeHandler:function(a){if(this.gl){var f=a.extent.getCenter();this.gl.setSize(a.width,a.height);this.gl.jumpTo({center:[f.getLongitude(),
f.getLatitude()]});this._div.style.width=a.width+"px";this._div.style.height=a.height+"px"}},onSuspend:function(){this.inherited(arguments);m.hide(this._div);this._disableDrawConnectors()},onResume:function(){this.inherited(arguments);if(this.gl&&this.style){m.show(this._div);var a=this._map,f=this._getZoom(a.getScale()),a=a.extent.getCenter();this._animate(a,f,!0)}this._enableDrawConnectors()},_onPanExtentChangeHandler:function(a){var f=this._getZoom(this._map.getScale());a=a.extent.getCenter();
this._animate(a,f,!0)},_onScaleHandler:function(a){var f=this._map,b=f._zoomAnimDiv.anchor,c=f._zoomAnimDiv.extent.getCenter(),f=this._getZoom(f._zoomAnimDiv.newLod.scale,f._zoomAnimDiv.newLod.level);this._animate(c,f,a.immediate,b)},_animate:function(a,f,b,c){this._animation&&(this._animation.stop(),this._animation=null);this._animation=J(this.gl,a.getLongitude(),a.getLatitude(),f,b,this._map,c)}}),r=null,C=null;p=Object.freeze||function(a){};for(var H=[],A=0;20>A;A++){var I=78271.51696402048/Math.pow(2,
A);H.push({level:A,scale:Math.floor(3779.527559055118*I),resolution:I})}var E=new B({rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:H});p(E);var F=new n(102100);p(F);var G=new s(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7,F);p(G);var N=new s(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7,F);p(N);var M=function(){var a,f=window.performance||{},b=f.now||f.webkitNow||f.msNow||f.oNow||f.mozNow;if(void 0!==
b)return function(){return b.call(f)};a=window.performance&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:(new Date).getTime();return function(){return(new Date).getTime()-a}}();p=d("ff");var H=d("ie"),A=d("webkit"),I=d("opera"),x=(new Date).getTime(),f=window.requestAnimationFrame;f||(f=window[(A&&"webkit"||p&&"moz"||I&&"o"||H&&"ms")+"RequestAnimationFrame"])||(f=function(a){var f=M(),b=Math.max(0,16-(f-x)),c=window.setTimeout(function(){a(M())},
b);x=f+b;return c});var y=w.ease,J=function(a,b,c,d,x,e,g){if(x=x||0===q.defaults.map.zoomDuration)return a.jumpTo({center:[b,c],zoom:Math.ceil(d)-Math.log(Math.abs(Math.ceil(d)-d+1))/Math.LN2}),null;var h=!0,J=q.defaults.map.zoomDuration,K=a.transform.center.lat,k=a.transform.center.lng,l=a.transform.zoom,D=M()+16,p=g?[g.x-e.width/2,g.y-e.height/2]:null,m=function(){if(h){var x=(M()+16-D)/J;1<=x&&(x=1,h=!1);var x=y(x),e=l+(d-l)*x,e=Math.ceil(e)-Math.log(Math.abs(Math.ceil(e)-e+1))/Math.LN2;p?a.zoomTo(e,
{animate:!1,offset:p}):a.jumpTo({center:[k+(b-k)*x,K+(c-K)*x],zoom:e});h&&f(m)}};m();return{stop:function(){h=!1}}},K=g(String,{constructor:function(a,f){this.value=a;this.token=f},valueOf:function(){var a=this.value,f=this.token;if(!f){var b=v.id&&v.id.findCredential(a);b&&b.token&&(f=b.token)}f&&(a+=(-1===a.indexOf("?")?"?":"\x26")+"token\x3d"+f);return a},toString:function(){return this.valueOf()},replace:function(a,f){return String.prototype.replace.call(this.valueOf(),a,f)}}),D={loadMetadata:function(f,
b){var c=null,y=null,d=b&&b.credential;return(new a).resolve(f).then(function(){r.config.ACCESS_TOKEN=u.ACCESS_TOKEN;if("string"!==typeof f)return f;D.isMapboxUrl(f)?(y=f,c=r.normalizeStyleURL(f)):y=c=t.normalize(f).replace(/\/*$/,"");D._corsify(c);c=D._appendToken(c,d);return z({url:c,content:{f:"json"},handleAs:"json"})}).then(function(a){return D._processMetadata(y,a,b)}).then(function(a){return D._loadStyle(a,b)})},isMapboxUrl:function(a){return-1<a.search(/^mapbox:\/\/styles\//)},_appendToken:function(a,
f){return!f||!f.token?a:a+=(-1===a.indexOf("?")?"?":"\x26")+"token\x3d"+f.token},_configureStyle:function(a,f){var b=a.layerDefinition,c=a.style,y=a.serviceUrl,d=a.styleUrl,x=D._getAbsolutePath,e=D._corsify;if(b&&c&&c.sources.esri){var g=b.tilejson||"2.0.0",h=b.tileInfo&&b.tileInfo.format||"pbf",J=b.tileMap?e(x(b.tileMap,y)):null,k=(b.tiles||[]).map(function(a){return new K(D._getAbsolutePath(a,y),f&&f.credential&&f.credential.token)});c.sources.esri={type:"vector",scheme:"xyz",tilejson:g,format:h,
index:J,tiles:k,description:b.description,name:b.name};k.forEach(e);c.glyphs=e(x(c.glyphs,d));c.sprite=e(x(c.sprite,d))}return{style:c,layerDefinition:b,serviceUrl:y,styleUrl:d}},_loadStyle:function(f,b){var c=new a,y=f.style,d=y.sources;b&&b.tileServers&&Object.getOwnPropertyNames(d).forEach(e.hitch(this,function(a){a=d[a];var c=b.tileServers.map(function(a){return new K(D._getAbsolutePath(a,f.serviceUrl,b))});a.tiles=c;c.forEach(D._corsify)}));r.identityManager=v.id;var y=new r.Style(y),x=function(){y.off("load",
x);y.off("error",g);f.style=y;c.resolve(f)},g=function(a){y.off("load",x);y.off("error",g);c.reject(a)};y.on("load",x);y.on("error",g);return c.promise},_getAbsolutePath:function(a,f){var b;f=t.urlToObject(f||"").path;if(/^https?:\/\//i.test(a))b=a;else{if(0===a.indexOf("//"))return location.protocol+a;f=f.replace(/(\/+\w+\.\w+)$/,"");/\/+$/.test(f)||(f+="/");0===a.indexOf("/")&&(a=a.substring(1));b=f+a}return t.normalize(b)},_corsify:function(a){a=a.valueOf();var f=q.defaults.io.corsEnabledServers;
if(!t.canUseXhr(a)){var b=new l(a),b=(b.host+(b.port?":"+b.port:"")).toLowerCase();-1===f.indexOf(b)&&f.push(b)}return a},_processMetadata:function(a,f,b){var c={},y,d,x=D._getAbsolutePath,g=D._configureStyle,h=D._corsify,J=b&&b.credential;delete f._ssl;if(f.currentVersion)return y=a,d=x(f.defaultStyles,y),z({url:D._appendToken(d,J),content:{f:"json"},handleAs:"json"}).then(e.hitch(this,function(a){return g({style:a,layerDefinition:f,styleUrl:d,serviceUrl:y},b)}));c=f;d=a;return f.sources.esri&&f.sources.esri.url?
(y=h(x(f.sources.esri.url,d)),z({url:D._appendToken(y,J),content:{f:"json"},handleAs:"json"}).then(e.hitch(this,function(a){return g({style:c,layerDefinition:a,styleUrl:d,serviceUrl:y},b)}))):g({style:c})}},P=g([],{constructor:function(){this._credentials=[]},addToken:function(a){if(!a||!a.url||!a.token)return!1;var f=this.getServiceRoot(a.url);this._credentials.push({rootUrl:f,token:a.token})},findCredential:function(a){var f=-1,b=this._credentials,c=this.getServiceRoot(a);b.some(function(a,b){if(a.rootUrl===
c)return f=b,!0});return-1<f?b[f]:null},getServiceRoot:function(a){var f=/(.+\/rest\/services\/.*\/?vectortileserver)/i,b=/(.+\/sharing\/.*)/i;return f.test(a)?a.match(f)[1].toLowerCase():b.test(a)?a.match(b)[1].toLowerCase():null},shareSameService:function(a,f){a=this.getServiceRoot(a);f=this.getServiceRoot(f);a=a.substr(a.indexOf(":"));f=f.substr(f.indexOf(":"));return a===f}});u.ACCESS_TOKEN=null;return u})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(h,g,e,l,c,b,d,a,k,m,t,v,q,z,n,s,p,B,w,u,r,C,H,A,I,E,F,G,N,M){h=h(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,f){this.useMapTime=f&&f.hasOwnProperty("useMapTime")?!!f.useMapTime:!0},_initialize:function(a,f){this._url=n.urlToObject(a);this.raster=new C(a);this.infoTemplate=f&&f.infoTemplate;var b=f&&f.imageServiceParameters;
this.format=b&&b.format;this.compressionTolerance=b&&b.compressionTolerance?b.compressionTolerance:0.01;this.interpolation=b?b.interpolation:null;this.compressionQuality=b?b.compressionQuality:null;this.bandIds=b?b.bandIds:null;this.mosaicRule=b?b.mosaicRule:null;this.renderingRule=b?b.renderingRule:null;this.useMapDimensionValue=f&&f.hasOwnProperty("useMapDimensionValue")?!!f.useMapDimensionValue:!0;this.activeMapDimensions=f&&f.activeMapDimensions;this._params=g.mixin({},this._url.query,{f:"image",
interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},b?b.toJson():{});this.pixelFilter=f&&f.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=g.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=g.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=g.hitch(this,this._initLayer);this._queryVisibleRastersHandler=
g.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=f&&f.loadCallback;(b=f&&f.resourceInfo)?this._initLayer(b):q({url:this._url.path,content:g.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,f){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&
this.credential.ssl||a&&a._ssl)&&this._useSSL();var b=this.minScale,c=this.maxScale;g.mixin(this,a);this.minScale=b;this.maxScale=c;this.initialExtent=this.fullExtent=this.extent=new s(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var d=this.minValues,e=this.maxValues,h=this.meanValues,k=this.stdvValues,l=this.bands=[],b=0,c=this.bandCount;b<c;b++)l[b]={min:d[b],max:e[b],mean:h[b],stddev:k[b]};
this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new E(b):null;c=this.fields=[];if(d=a.fields)for(b=0;b<d.length;b++)c.push(new F(d[b]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);v.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);v.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);b={};a.defaultMosaicMethod?(b.method=a.defaultMosaicMethod,b.operation=a.mosaicOperator,b.sortField=a.sortField,b.sortValue=
a.sortValue):b.method=w.METHOD_NONE;this.defaultMosaicRule=new w(b);this.defaultMosaicRule.ascending=!0;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(g.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=g.clone(a.features));a&&(a.fields&&
0<a.fields.length)&&(this._rasterAttributeTableFields=g.clone(a.fields))}));this._isVectorData()&&!v.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new A,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(g.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(b=this._loadCallback)delete this._loadCallback,b(this)}},
getKeyProperties:function(){var a=this._url.path+"/keyProperties",f=new e(z._dfdCanceller);10<this.version?(f._pendingDfd=q({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),f._pendingDfd.then(function(a){f.callback(a)},function(a){f.errback(a)})):(a=Error("Layer does not have key properties"),a.log=b.isDebug,f.errback(a));return f},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",f=new e(z._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?
(f._pendingDfd=q({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),f._pendingDfd.then(function(a){f.callback(a)},function(a){f.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=b.isDebug,f.errback(a));return f},_getRasterAttributeTableFeatures:function(){var a=new e;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=
this.getRasterAttributeTable(),a.then(g.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=g.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var f=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var b={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},
c={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},d={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},e=this.fields?g.clone(this.fields):[];a=e.length;e[a]=c;if(10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none")))a++,
e[a]=d;if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,e[a]=b;if(v.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))b={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},c={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},
a++,e[a]=b,a++,e[a]=c;this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&(a=l.filter(this._rasterAttributeTableFields,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),a=l.map(a,function(a){var b=g.clone(a);b.name=f+a.name;return b}),e=e.concat(a));var h=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&l.forEach(this.rasterFunctionInfos,function(a){a&&(a.name&&"none"!==a.name.toLowerCase())&&
(a={name:h+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},e.push(a))});return e},_prepareGetImageParameters:function(a,f,b,d){d=v.isDefined(d)?d:this._params;var e=a.spatialReference.wkid||c.toJson(a.spatialReference.toJson(!1));delete d._ts;g.mixin(d,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:e,bboxSR:e,size:f+","+b},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete d.compressionTolerance;d.format&&"LERC"===d.format.toUpperCase()&&
(d.compressionTolerance=this.compressionTolerance);d.token=this._getToken()},getImageUrl:function(a,f,b,c,d){d=v.isDefined(d)?d:this._params;this._prepareGetImageParameters(a,f,b,d);a=g.clone(d);this._cleanupRequestParams(a);f=this._url.path+"/exportImage?";b=n.addProxy(f+k.objectToQuery(g.mixin(a,{f:"image"})));var e=a.token;b.length>t.defaults.io.postLength||this.useMapImage?this._jsonRequest=q({url:f,content:g.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(a,f){var b=a.href;e&&
(b+=-1===b.indexOf("?")?"?token\x3d"+e:"\x26token\x3d"+e);c(n.addProxy(b))},error:this._errorHandler}):c(b)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,f){this.interpolation=this._params.interpolation=a;f||this.refresh(!0)},setCompressionQuality:function(a,f){this.compressionQuality=this._params.compressionQuality=a;f||this.refresh(!0)},setCompressionTolerance:function(a,f){this.compressionTolerance=a;f||this.refresh(!0)},setBandIds:function(a,f){var b=
!1;this.bandIds!==a&&(b=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(b&&!f)this.onRenderingChange();f||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var d=!1;this.mosaicRule!==a&&(d=!0);this.mosaicRule=a;this._params.mosaicRule=c.toJson(a.toJson());if(d&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var d=
!1;this.renderingRule!==a&&(d=!0);this.renderingRule=a;this._params.renderingRule=a?c.toJson(a.toJson()):null;if(d&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=w.METHOD_NONE);c.where=a;c=new w(c);
this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(a,
b,c,d){var g=this._map,h=z._fixDfd(new e(z._dfdCanceller));this._visibleRasters=[];var k,m,n=!0,s=this.infoTemplate?this.infoTemplate.info:null,q=s?this.infoTemplate.info.fieldInfos:null;if(q&&0<q.length){n=!1;for(k=0;k<q.length;k++)if((m=q[k])&&m.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(m.visible||s.title&&-1<s.title.toLowerCase().indexOf(m.fieldName.toLowerCase()))){n=!0;break}}var v=(m=this._removeVisualizationStretchFunction(this.renderingRule))&&m.functionName,
r=[];if(10.4<=this.version){var t=!1;if(this.rasterFunctionInfos&&q){var w=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;l.forEach(this.rasterFunctionInfos,function(a){var b=w+a.name.replace(/ /gi,"_");l.some(q,function(a){return a.visible&&a.fieldName===b})&&(t=t||v&&v===a.name,r.push(new u({rasterFunction:a.name})))})}m&&!t&&r.push(m)}k=new M;k.geometry=a.geometry;k.returnGeometry=this._map.spatialReference.equals(this.spatialReference);k.returnCatalogItems=n;k.timeExtent=a.timeExtent;
k.mosaicRule=this.mosaicRule||null;k.renderingRule=10.4>this.version&&m||null;k.renderingRules=r||null;g&&(a=new p((g.extent.xmax-g.extent.xmin)/(2*g.width),(g.extent.ymax-g.extent.ymin)/(2*g.height),g.extent.spatialReference),k.pixelSize=a);b.requestParams=k;var B=this;a=new N(this.url);(h._pendingDfd=a.execute(k)).addCallbacks(function(a){B._queryVisibleRastersHandler(a,b,c,d,h)},function(a){B._resolve([a],null,d,h,!0)});return h},_queryVisibleRastersHandler:function(a,b,d,e,h){function k(){var a=
this.getCustomRasterFields(b),c=this._getDomainFields(a),e=b?b.returnDomainValues:!1,J=b&&b.rasterAttributeTableFieldPrefix,x,q,t,D,u,w,A,z,B;this._getRasterAttributeTableFeatures().then(g.hitch(this,function(a){for(x=0;x<r.length;x++){L=r[x];L.setInfoTemplate(this.infoTemplate);L._layer=this;if(m){B=m.replace(/ /gi,"").split(",");q=m;t=B;n&&n.length>=x&&(q=n[x].replace(/ /gi,", "),t=n[x].split(" "));L.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=t;L.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=
B;p&&(L.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=p.replace(/ /gi,"").split(","));if(this.pixelFilter){var b=new H({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});l.forEach(t,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new s(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)L.attributes[this._rasterFieldPrefix+
"Magnitude"]=b.pixels[0][0],L.attributes[this._rasterFieldPrefix+"Direction"]=b.pixels[1][0]}l.forEach(F,function(a){L.attributes[a.name]=a.value});if(a&&0<a.length&&(D=l.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==q:a.attributes.VALUE==q}),0<D.length&&(u=g.clone(D[0]),J&&u))){z={};for(w in u.attributes)u.attributes.hasOwnProperty(w)&&(A=J+w,z[A]=u.attributes[w]);u.attributes=z;L.attributes=g.mixin(L.attributes,u.attributes)}}e&&(c&&0<c.length)&&
l.forEach(c,function(a){if(a){var b=L.attributes[a.name];v.isDefined(b)&&(b=this._getDomainValue(a.domain,b),v.isDefined(b)&&(L.attributes[a.name]=b))}},this);S.push(L);this._visibleRasters.push(L)}this._resolve([S,null,!0],null,d,h)}))}var m=a.value,p=a.value,n,r,t=0,u=0,w=this,z=this.objectIdField,A,C,F=[];e=b.requestParams.renderingRules;var E=a.processedValues,I=this.renderingRule&&dojo.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(e&&E&&e.length===E.length){var M=
this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;l.forEach(e,function(a,b){if(a.functionName){var f={name:M+a.functionName.replace(/ /gi,"_"),value:E[b].replace(/ /gi,"").split(",")};F.push(f);I&&I===dojo.toJson(a.toJson())&&(m=E[b])}})}e=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var N=0,T,Q,R=a.catalogItems.features.length;
C=0;r=Array(R);n=Array(R);A=Array(R);for(t=0;t<R;t++)-1<a.properties.Values[t].toLowerCase().indexOf("nodata")&&C++;T=R-C;for(t=0;t<R;t++)C=!0,-1<a.properties.Values[t].toLowerCase().indexOf("nodata")?(Q=T++,e||(C=!1,r.length--,n.length--,A.length--)):Q=N++,C&&(r[Q]=a.catalogItems.features[t],n[Q]=a.properties.Values[t],A[Q]=r[Q].attributes[z])}this._visibleRasters=[];var L;if((a=-1<m.toLowerCase().indexOf("nodata"))&&!e)r=[],n=[],A=[];m&&(!r&&!a)&&(z="ObjectId",r=[],L=new G(new s(this.fullExtent),
null,{ObjectId:0}),r.push(L));var S=[];r?!this._map.spatialReference.equals(this.spatialReference)&&A&&0<A.length?q({url:this._url.path+"/query",content:{f:"json",objectIds:A.join(","),returnGeometry:!0,outSR:c.toJson(w._map.spatialReference.toJson()),outFields:z},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)w._resolve([S,null,null],null,d,h);else{for(t=0;t<a.features.length;t++)for(u=0;u<r.length;u++)r[u].attributes[z]==a.features[t].attributes[z]&&(r[u].geometry=
new B(a.features[t].geometry),r[u].geometry.setSpatialReference(w._map.spatialReference));k.call(w)}},error:function(a){w._resolve([S,null,null],null,d,h)}}):k.call(this):this._resolve([S,null,null],null,d,h)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];l.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,
b){if(a&&a.codedValues){var c;l.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=g.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=g.clone(this._params);this._cleanupRequestParams(b);b.extent=a;c=null;this._useBrowserDecoding()&&(c=new I({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?
g.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=
null},_drawPixelData:function(){},_requestDataErrorHandler:function(a){},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=g.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;for(var d=b*c,e=0,g=0,h=new Uint8Array(d),k=new Uint8Array(d),l=new Uint8Array(d),m=new Uint8Array(d),n=Infinity,p=Infinity,q=Infinity,r=-Infinity,s=-Infinity,t=-Infinity,
u,v,w,e=0;e<d;e++)u=a[g++],v=a[g++],w=a[g++],n=n<u?n:u,r=r>u?r:u,p=p<v?p:v,s=s>v?s:v,q=q<w?q:w,t=t>w?t:w,h[e]=u,k[e]=v,l[e]=w,m[e]=a[g++]&1;return new H({width:b,height:c,pixels:[h,k,l],pixelType:"U8",mask:m,statistics:[{minValue:n,maxValue:r},{minValue:p,maxValue:s},{minValue:q,maxValue:t}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"==this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=
this._url.path+"/multiDimensionalInfo",f=new e(z._dfdCanceller);if(this._multidimensionalInfo)return f.resolve(this._multidimensionalInfo),f;10.3<=this.version&&this.hasMultidimensions?(f._pendingDfd=q({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),f._pendingDfd.then(g.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;f.callback(a.multidimensionalInfo)}),function(a){f.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=b.isDebug,
f.errback(a));return f},getDefaultMultidimensionalDefinition:function(){var a,b,c,d=[],h=new e(z._dfdCanceller);if(this._defaultMultidimensionalDefinition)return h.resolve(this._defaultMultidimensionalDefinition),h;h._pendingDfd=this.getMultidimensionalInfo();h._pendingDfd.then(g.hitch(this,function(e){a=e;b=a.variables[0].dimensions;for(c in b)b.hasOwnProperty(c)&&(b[c].hasRanges&&!0==b[c].hasRanges?d.push(new r({variableName:"",dimensionName:b[c].name,isSlice:!1,values:[b[c].values[0]]})):d.push(new r({variableName:"",
dimensionName:b[c].name,isSlice:!0,values:[b[c].extent[0]]})));this._defaultMultidimensionalDefinition=d;h.callback(d)}),function(a){h.errback(a)});return h},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(g.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?(c=g.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=g.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new w({multidimensionalDefinition:b}),
this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"==this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?
7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new u(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new w(c.fromJson(a.mosaicRule));if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var d=l.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==
a.dimensionName});b.multidimensionalDefinition=d;a.mosaicRule=c.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),e;for(e in b)a.hasOwnProperty(b[e])&&delete a[b[e]];return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&l.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?
c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(a){return l.some(a&&(this.rasterFunctionInfos||[]),function(b){return b&&b.name&&
b.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new H({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new s(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&z._resDfd(d,a,e)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=
d.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(d.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))}});a("extend-esri")&&g.setObject("layers.ImageServiceLayerMixin",
h,m);return h})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"*noref":1}});
define("esri/dijit/BasemapGallery","require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../urlUtils ../request ../geometry/Extent ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),function(h,
g,e,l,c,b,d,a,k,m,t,v,q,z,n,s,p,B,w,u,r,C,H,A,I,E,F,G,N,M,x){g=g([M,z,n],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:x,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(a,b){a=a||{};a.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");this.map=
a.map;this._hasUI=b?!0:!1;this.bingMapsKey=a.bingMapsKey&&0<a.bingMapsKey.length?a.bingMapsKey:null;this.showArcGISBasemaps=!1===a.showArcGISBasemaps?!1:!0;this.basemaps=a.basemaps||[];this.basemapIds=a.basemapIds;this.referenceIds=a.referenceIds;this.basemapsGroup=a.basemapsGroup;this.arcgisUrl=s.dijit._arcgisUrl;a.portalUrl&&(this.arcgisUrl=a.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=window.location.protocol+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);e.forEach(this.basemaps,function(a,b){if(!a.id||0===a.id.length)a.id=this._getUniqueId();e.forEach(a.layers,function(a){a.opacity=0<=a.opacity?a.opacity:1;a.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&e.forEach(this.basemapIds,function(a){this.map.getLayer(a)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&e.forEach(this.referenceIds,
function(a){a=this.map.getLayer(a);a._basemapGalleryLayerType="reference";a.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(c.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(c.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():l.connect(this,"onLoad",c.hitch(this,function(){this._refreshUI()}))},
select:function(a){this._select(a)},getSelected:function(){return this._selectedBasemap},get:function(a){var b;for(b=0;b<this.basemaps.length;b++)if(this.basemaps[b].id==a)return this.basemaps[b];return null},add:function(a){return a&&!a.id?(a.id=this._getUniqueId(),this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):a&&this._isUniqueId(a.id)?(this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):!1},remove:function(a){var b;for(b=0;b<this.basemaps.length;b++){var c=this.basemaps[b];if(c.id===
a)return this._selectedBasemap&&this._selectedBasemap.id===c.id&&(this._selectedBasemap=null),this.basemaps.splice(b,1),this._refreshUI(),this.onRemove(c),c}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(a){},onRemove:function(a){},onError:function(a){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&(0<this.basemaps.length&&
!this._selectBasemapInProgress)&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(a){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,a):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(a))},_findArcGISBasemapsGroup:function(a){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(a);else{var d=this.arcgisUrl+"/accounts/self",e={f:"json"};
e.culture=b.locale;B({url:d,content:e,callbackParamName:"callback",load:c.hitch(this,function(b,c){this._basemapGalleryGroupQuery=b&&b.basemapGalleryGroupQuery?b.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(a)}),error:c.hitch(this,function(a,b){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(a){var b=c.hitch(this,"_findArcGISBasemaps"),d=this.arcgisUrl+"/community/groups",e={};
e.q=this._basemapGalleryGroupQuery;e.f="json";B({url:d,content:e,callbackParamName:"callback",load:c.hitch(this,function(c,d){if(0<c.results.length)b(c.results[0].id,a);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:c.hitch(this,function(a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(a,b){var d=this.arcgisUrl+"/search",e={};e.q="group:"+a+' AND type:"web map"';e.sortField="name";e.sortOrder=
"desc";e.num=50;e.f="json";B({url:d,content:e,callbackParamName:"callback",load:c.hitch(this,function(a,c){if(0<a.results.length)b(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:c.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_handleArcGISBasemapsResponse:function(a){0<a.length&&(e.forEach(a,function(a,b){if(this.bingMapsKey||!this.bingMapsKey&&a.title&&-1==a.title.indexOf("Bing Maps")){var c=
{};c.id=this._getUniqueId();c.title=a.title;c.thumbnailUrl="";if(a.thumbnail&&a.thumbnail.length&&(c.thumbnailUrl=this.arcgisUrl+"/content/items/"+a.id+"/info/"+a.thumbnail,s.id)){var f=s.id.findCredential(p.urlToObject(this.arcgisUrl).path);f&&(c.thumbnailUrl+="?token\x3d"+f.token)}c.itemId=a.id;c=new N(c,this);this.basemaps.splice(0,0,c)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(v.empty(this.flowContainer),e.forEach(this.basemaps,function(a,b){a.id||(a.id="basemap_"+b);
this.flowContainer.appendChild(this._buildNodeLayout(a))},this),v.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(a){var b=v.create("div",{id:"galleryNode_"+a.id,"class":"esriBasemapGalleryNode"}),d=v.create("a",{href:"javascript:void(0);"},b);l.connect(d,"onclick",c.hitch(this,"_onNodeClick",a));var e=a.title||"";a.thumbnailUrl?v.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.thumbnailUrl,title:e,alt:e},d):v.create("img",
{"class":"esriBasemapGalleryThumbnail",src:h.toUrl("./images/transparent.gif"),title:e,alt:e},d);a=v.create("div",{"class":"esriBasemapGalleryLabelContainer"},b);v.create("span",{innerHTML:e,alt:e,title:e},a);return b},_onNodeClick:function(a,b){b.preventDefault();this._markSelected(a);this.select(a.id)},_markSelected:function(a){a&&(e.forEach(b.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){q.remove(a,"esriBasemapGallerySelectedNode")}),(a=t.byId("galleryNode_"+a.id))&&q.add(a,
"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=!0;var b=this.get(a);b?(b.layers?this._getServiceInfos(b):(a=b.getLayers(this.arcgisUrl),c.isArray(a)?this._getServiceInfos(b):a.addCallback(c.hitch(this,function(a){this._getServiceInfos(b)}))),this._markSelected(b)):this._selectBasemapInProgress=!1},_getServiceInfos:function(a){"https:"==location.protocol&&e.forEach(a.layers,function(a){if(this._isAgolService(a.url)||this._isHostedService(a.url))a.url=a.url.replace("http:",
"https:")},this);this._selectedBasemap=a;var b=[];e.forEach(a.layers,function(a){a.url&&(0<a.url.length&&!a.isReference&&!a.type)&&(a.deferredsPos=b.length,b.push(this._getServiceInfo(a.url)))},this);0<b.length?(new m(b)).addCallback(c.hitch(this,function(b){var c=null;e.forEach(a.layers,function(a){if(0===a.deferredsPos||a.deferredsPos){a.serviceInfoResponse=b[a.deferredsPos][1];var d=a.serviceInfoResponse.fullExtent;d||(d=a.serviceInfoResponse.extent);c=c?c.union(new w(d)):new w(d)}},this);this.map.extent&&
5>this._getIntersectionPercent(c,this.map.extent)&&this.map.setExtent(c,!0);this._switchBasemapLayers(a);this._updateReferenceLayer(a)})):(this._switchBasemapLayers(a),this._updateReferenceLayer(a))},_switchBasemapLayers:function(a){a=a.layers;if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===a[0].type||a[0].type&&-1<a[0].type.indexOf("BingMaps")||"WebTiledLayer"===a[0].type||"VectorTileLayer"===a[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
else{e.forEach(a,function(a){if(!a.isReference&&a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);this._removeBasemapLayers();var b=0;e.forEach(a,function(a){if(!a.isReference){var c;if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=
new r({id:"layer_osm",opacity:a.opacity})}else if(a.type&&-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=u.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"==a.type?c=u.MAP_STYLE_AERIAL:"BingMapsRoad"==a.type&&(c=u.MAP_STYLE_ROAD);c=new u({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:c,opacity:a.opacity})}else if("WebTiledLayer"==
a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=a.initialExtent||a.fullExtent;c=new A(a.templateUrl||a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new w(a.fullExtent),initialExtent:c&&new w(c),subDomains:a.subDomains,tileInfo:a.tileInfo?new E(a.tileInfo):null,tileServers:a.tileServers})}else"VectorTileLayer"==
a.type?c=new I(a.styleUrl,{visible:a.visibility,opacity:a.opacity}):a.serviceInfoResponse&&a.serviceInfoResponse.mapName?c=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):a.serviceInfoResponse&&a.serviceInfoResponse.pixelSizeX&&(c=new G,c.bandIds=a.bandIds,!a.bandIds&&(a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount))&&(c.bandIds=[0,1,2]),c=new F(a.url,{resourceInfo:a.serviceInfoResponse,
opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));c&&(c._basemapGalleryLayerType="basemap",this.map.addLayer(c,b),b++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var a=this.map.layerIds,b=[];e.forEach(a,function(a){a=this.map.getLayer(a);"basemap"===a._basemapGalleryLayerType&&b.push(a)},this);0===b.length&&0<a.length&&b.push(this.map.getLayer(a[0]));0<b.length&&e.forEach(b,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var b;
this._removeReferenceLayer();for(b=0;b<a.layers.length;b++)!0===a.layers[b].isReference&&this._addReferenceLayer(a.layers[b])},_removeReferenceLayer:function(){var a;for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&this.map.removeLayer(b)}},_addReferenceLayer:function(a){"VectorTileLayer"===a.type?this._handleReferenceServiceInfoResponse(a):this._getServiceInfo(a.url,c.hitch(this,"_handleReferenceServiceInfoResponse",
a))},_handleReferenceServiceInfoResponse:function(a,b,c){var d;a.serviceInfoResponse=b;"VectorTileLayer"===a.type?d=new I(a.styleUrl,{visible:a.visibility,opacity:a.opacity}):b&&b.mapName?d=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(c=new G,c.bandIds=a.bandIds,!a.bandIds&&(b.bandCount&&3<parseInt(b.bandCount))&&(c.bandIds=[0,1,2]),d=new F(a.url,{resourceInfo:b,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));d&&(d._basemapGalleryLayerType=
"reference",d.attr("data-reference",!0),this.map.addLayer(d))},_getServiceInfo:function(a,b){return B({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,c){b&&b(a,c)},error:c.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(a){var b=[];a.displayLevels||(b=e.map(a.serviceInfoResponse.tileInfo.lods,function(a){return a.level}));var c=null;a.exclusionAreas&&a.exclusionAreas.length&&(c=[],e.forEach(a.exclusionAreas,
function(a){c.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new w(a.geometry)})}));return new C(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,exclusionAreas:c,displayLevels:a.displayLevels||b})},_loadAsDynamic:function(a){var b=new H(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});a.visibleLayers&&b.setVisibleLayers(a.visibleLayers);return b},_getIntersectionPercent:function(a,b){var c=
b.intersects(a);if(c){var c=c.getWidth()*c.getHeight(),d=b.getWidth()*b.getHeight();return 100*(c/d)}return 0},_getIds:function(){var a=[];e.forEach(this.basemaps,function(b){a.push(b.id)},this);return a},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;)if(-1<a.indexOf(",basemap_"+b+","))b++;else return"basemap_"+b},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+",").indexOf(","+a+",")?!0:!1},_isAgolService:function(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||
-1!==a.indexOf("/server.arcgisonline.com/")},_isHostedService:function(a){return!a?!1:-1!==a.indexOf(".arcgis.com/")}});a("extend-esri")&&c.setObject("dijit.BasemapGallery",g,s);return g});